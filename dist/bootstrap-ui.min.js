(function(window){"use strict";function plugin(name,constructor){function BuiItemConstructor(){p.init&&(p.init(),delete p.init);var $obj;$obj=this.__proto__==$.fn?this:$("<div/>"),$obj.addClass(p.containerClass?" bui-"+p.containerClass:""),$obj.data("bui",name.toLowerCase()),$obj.data("_bui",$obj),$obj.large=function(){return $obj.hasClass("bui-"+p.containerClass+"-sm")&&$obj.removeClass("bui-"+p.containerClass+"-sm"),$obj.addClass("bui-"+p.containerClass+"-lg"),$obj},$obj.small=function(){return $obj.hasClass("bui-"+p.containerClass+"-lg")&&$obj.removeClass("bui-"+p.containerClass+"-lg"),$obj.addClass("bui-"+p.containerClass+"-sm"),$obj},p.proxyInput&&(jquery_function_replace($obj,"attr")("name",function(n){$obj.$input.attr("name",n)},function(){return $obj.$input.attr("name")}),$obj.val=function(v){return 1>arguments.length?(v=$obj.$input.val(),$obj.$input.getValue?$obj.$input.getValue(v):v):$obj.$input.setValue&&(v=$obj.$input.setValue(v),v===!1)?this:($obj.$input.val(v),this)}),modify_jquery($obj);var fn;for(var type in handles){fn=jquery_function_replace($obj,type);for(var n in handles[type])fn(n,handles[type][n].set,handles[type][n].get)}for(type in proxis)$obj[type]=proxis[type];if(constructor.apply($obj,arguments),p.proxyInput&&!$obj.$input)throw Error("目标输入域没有定义（$bui."+name+".$input）");return $obj}var handles={},proxis={},p=BuiItemConstructor;return p.containerClass=name.toLowerCase(),p.hook=function(type,name,gs,func){return handles[type]||(handles[type]={}),handles[type][name]||(handles[type][name]={}),handles[type][name][gs]=func,this},p.proxy=function(func,cb){return proxis[func]=cb,this},p}function trigger_change(ths){return ths.trigger("change",Array.prototype.slice.call(arguments,1))}function jquery_function_replace($obj,func_name){function processor(elem,name,value){var handle="_"+name,isGet=void 0===value;if(void 0!==$obj[func_name].handle[handle]&&void 0!==$obj[func_name].handle[handle][isGet?"get":"set"])if(isGet){if(value=$obj[func_name].handle[handle].get.call($obj),void 0!==value)return value}else if(value=$obj[func_name].handle[handle].set.call($obj,value),void 0===value)return!1;return $.fn[func_name].apply($obj,Array.prototype.slice.call(arguments,1))}if($.fn[func_name]&&!$obj[func_name])throw window.JS_DEBUG&&console.error($obj),Error(" * 参数不是jquery对象。");return $.fn[func_name]!=$obj[func_name]?$obj[func_name].handle:($obj[func_name]=function(name,value){return jQuery.access(this,processor,name,value,!1)},$obj[func_name].handle=function(name,setter,getter){if("object"==typeof name)for(var n in name)$obj[func_name].handle(n,name[n].set,name[n].get);var handle="_"+name;return $obj[func_name].handle[handle]||($obj[func_name].handle[handle]={}),setter&&($obj[func_name].handle[handle].set=setter),getter&&($obj[func_name].handle[handle].get=getter),$obj[func_name].handle[handle]},$obj[func_name].handle)}function modify_jquery($obj){$.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){$obj[name]=function(selector){var target=$(selector);return 0==target.length?this:($(target[0])[original](this),this)}})}function intval(val){var tmp,type=typeof val;return"boolean"===type?+val:"string"===type?(tmp=parseFloat(val),isNaN(tmp)||!isFinite(tmp)?0:tmp):"number"===type&&isFinite(val)?0|val:0}function keycodefilter(plogic_and,pspecial_keys){function testSpecial(code){return 47>code?!0:code>90&&94>code?!0:code>111&&146>code?!0:!1}var logic_and,filter=[],equal=[],i=0,special_keys=!1;"string"==typeof plogic_and?(logic_and=!("or"==plogic_and),i++):"boolean"==typeof plogic_and&&(logic_and=!1,special_keys=plogic_and,i++),"boolean"==typeof pspecial_keys&&(i++,special_keys=pspecial_keys);for(var fn=null,len=arguments.length;len>i;i++)"function"!=typeof arguments[i]?parseInt(arguments[i])==arguments[i]?equal.push(parseInt(arguments[i])):filter.push(Range(arguments[i])):fn=arguments[i];return function(event){if(event.shiftKey||event.ctrlKey||event.altKey)return fn?fn.apply(this,arguments):!0;if(special_keys&&testSpecial(event.which))return fn?fn.apply(this,arguments):!0;for(var in_range=!1,i=equal.length-1;i>=0;i--){if(in_range=equal[i]===event.which,logic_and&&!in_range)return event.preventDefault(),void 0;if(in_range)return fn?fn.apply(this,arguments):!0}for(i=filter.length-1;i>=0;i--){if(in_range=filter[i].test(event.which),logic_and&&!in_range)return event.preventDefault(),void 0;if(in_range)return fn?fn.apply(this,arguments):!0}return in_range?fn?fn.apply(this,arguments):!0:(event.preventDefault(),void 0)}}function Range(range){var r=[-1/0,1/0],rr=[!0,!0],ret={test:function(value){return(rr[0]?value>=r[0]:value>r[0])&&(rr[1]?r[1]>=value:r[1]>value)},fit:function(value){return(rr[0]?r[0]>value:r[0]>=value)?rr[0]?r[0]:r[0]+1:(rr[1]?value>r[1]:value>=r[1])?rr[1]?r[1]:r[1]-1:value},toString:function(){return(rr[0]?"[":"(")+r[0]+","+r[1]+(rr[1]?"]":")")},fromString:function(str){try{return parseFloat(str)==str?(rr[1]=rr[0]=!0,r[0]=r[1]=parseFloat(str),ret):str?(r=str.split(","),rr[0]="["==r[0].substr(0,1),rr[1]="]"==r[1].substr(-1),r[0]=r[0].substr(1),r[1]=r[1].substr(0,r[1].length-1),r[0]=r[0].length?intval(r[0]):-1/0,r[1]=r[1].length?intval(r[1]):1/0,ret):(r[0]=-1/0,r[1]=1/0,ret)}catch(e){throw Error("范围错误："+str)}}};return Object.defineProperty(ret,"min",{get:function(){return r[0]},set:function(value){return r[0]=value}}),Object.defineProperty(ret,"max",{get:function(){return r[1]},set:function(value){return r[1]=value}}),Object.defineProperty(ret,"left",{get:function(){return rr[0]},set:function(value){return rr[0]=value}}),Object.defineProperty(ret,"right",{get:function(){return rr[1]},set:function(value){return rr[1]=!!value}}),range=$.trim(range),range.length?ret.fromString(range):ret}function bui_bool(value){return"string"==typeof value&&(value=value.toLowerCase(),value="on"==value||"yes"==value),"boolean"!=typeof value&&(value=!!value),value}function mouse_button(expect,fn){return"string"==typeof expect&&(expect=expect.toLowerCase(),"left"==expect?expect=1:"right"==expect?expect=3:"middle"==expect&&(expect=2)),"function"==typeof expect&&(fn=expect,expect=1),function(e){e.which===expect&&fn.apply(this,arguments)}}var module={exports:window,name:"$bui"},$bui=function(call){return this[call].apply(this,Array.slice.call(arguments,1))};$bui.plugin=plugin,module.exports[module.name]=$bui,function($bui){function construct(inner,domtype,type){var input,that=this;switch(domtype){case"submit":input=$('<input class="btn"/>').attr("type","submit");break;case"input":input=$('<input class="btn"/>').attr("type","button");break;case"button":that=$('<button class="btn"/>').appendTo(this),this._text=function(item){input.val(item)};break;default:this.addClass("btn")}input?(this.append(input),this.self=input,this._text=function(item){void 0===item?input.val():input.val(item)}):(this.self=that,this._text=function(item){return void 0===item?that.text():that.empty().append(item)}),type||(type="default"),this.attr({type:type,text:inner,"data-style":domtype})}var Button=$bui.Button=plugin("Button",construct);Button.hook("attr","text","get",function(){return this._text(),!1}),Button.hook("attr","text","set",function(text){this._text(text)}),Button.hook("attr","type","get",function(){return this.ctype}),Button.hook("attr","type","set",function(value){this.ctype&&this.self.removeClass("btn-"+this.ctype),this.self.addClass("btn-"+value),this.ctype=value})}($bui),function($bui){function construct(label){var $label=$("<label>").appendTo(this);$('<span class="checkbox-show">').appendTo($label).html('<span class="ico"/>'),this.$input=$("<input/>").val("false").attr("type","hidden").appendTo($label),this.$text=$('<span class="checkbox-title"/>').appendTo($label),this.addClass("checkbox");var checked=!1;this.$input.setValue=function(v){return checked=bui_bool(v),$this[(checked?"add":"remove")+"Class"]("active"),checked?"true":"false"},this.$input.getValue=function(){return checked};var $this=this;this.click(function(){return $this.val(!checked),trigger_change($this,checked),!1}),label&&this.attr("label",label)}var CheckBox=$bui.CheckBox=plugin("CheckBox",construct);CheckBox.proxyInput=!0,CheckBox.hook("attr","label","set",function(v){this.$text.text(v)}),CheckBox.hook("attr","label","get",function(){return this.$text.text()})}($bui),function($bui){function parseNewElement($item){var type=$item.data("bui");return"button"==type||("icon"==type?$item=$('<span class="bui-icon-outer"/>').append($item):$item.filter("input:not(:button,:submit)").length?$item.addClass("form-control"):$item.filter("span,a").length&&$item.addClass("bui-icon-outer")),$item}function construct(){var $this=this,$center=$('<div class="center-widget"/>').appendTo($this);$this.$input=$('<input class="form-control"/>').attr("type","text").appendTo($center);var $prepend,$append;$this.addClass("input-group");var hidden=!1;$this.centerWidget=function(newvalue){return 1==arguments.length&&(hidden&&(hidden.remove(),hidden=null),"hidden"==newvalue.attr("type")?(hidden=$('<input class="form-control"/>').attr({disabled:"disabled",type:"text"}).val(newvalue.attr("title")),$this.$input.replaceWith(hidden),newvalue.insertAfter(hidden)):(newvalue.hasClass("bui-formcontrol")||newvalue.addClass("form-control"),$this.$input.replaceWith(newvalue)),$this.$input=newvalue),$this.$input};var alert="";$this.alert=function(type){alert!=type&&($this.removeClass("alert-"+alert),allow_type.test(type)?($this.addClass("alert-"+type.toLowerCase()),alert=type):alert="")},$this.append=function($item){return $append||($append=$('<div class="input-group-btn btn-group bui-append"/>'),$.fn.append.call($this,$append)),$item=parseNewElement($item),$item.appendTo($append),$item},$this.prepend=function($item){return $prepend||($prepend=$('<div class="input-group-btn bui-prepend"/>'),$.fn.prepend.call($this,$prepend)),$item=parseNewElement($item),$item.prependTo($prepend)}}var allow_type=/^warning|success|error$/i,FormControl=$bui.FormControl=plugin("FormControl",construct);FormControl.proxyInput=!0}($bui),function($bui){function buildUrl(data){var ret="http://www.gravatar.com/avatar/";ret+=data.hash,ret+="."+(data.type?data.type:"png"),ret+="?",ret+="s="+data.size,data.rating&&(ret+="&r="+data.rating);var def=data.default||gravatar.default;return/^https?:\/\//i.test(def)?ret+="&d="+encodeURIComponent(def):/[0-9a-z]{32}/i.test(def)?ret+="&d="+encodeURIComponent("http://www.gravatar.com/avatar/"+def+".png"):def&&(ret+="&d="+def),ret}function Gravatar(size,hash){this.addClass("gravatar"),this._gravatar={},this._reset=function(){var href=buildUrl(this._gravatar);this.css({backgroundImage:"url("+href+")",height:this._gravatar.size,width:this._gravatar.size})},this.attr({size:size,hash:hash})}var gravatar=$bui.Gravatar=plugin("Gravatar",Gravatar);gravatar.hook("attr","hash","set",function(hash){return this._gravatar.hash=hash,this._reset(),hash}),gravatar.hook("attr","size","set",function(size){return this._gravatar.size=size,this._reset(),size}),gravatar.default="identicon",gravatar.build=buildUrl}($bui),function($bui){function construct(icon){this.addClass("glyphicon");var last="";this.change=function(icon){return icon?(last&&this.removeClass("glyphicon-"+last),this.addClass("glyphicon-"+icon),last=icon,this):last},icon&&this.change(icon)}var list="adjust,align-center,align-justify,align-left,align-right,arrow-down,arrow-left,arrow-right,arrow-up,asterisk,backward,ban-circle,barcode,bell,bold,book,bookmark,briefcase,bullhorn,calendar,camera,certificate,check,chevron-down,chevron-left,chevron-right,chevron-up,circle-arrow-down,circle-arrow-left,circle-arrow-right,circle-arrow-up,cloud,cloud-download,cloud-upload,cog,collapse-down,collapse-up,comment,compressed,copyright-mark,credit-card,cutlery,dashboard,download,download-alt,earphone,edit,eject,envelope,euro,exclamation-sign,expand,export,eye-close,eye-open,facetime-video,fast-backward,fast-forward,file,film,filter,fire,flag,flash,floppy-disk,floppy-open,floppy-remove,floppy-save,floppy-saved,folder-close,folder-open,font,forward,fullscreen,gbp,gift,glass,globe,hand-down,hand-left,hand-right,hand-up,hd-video,hdd,header,headphones,heart,heart-empty,home,import,inbox,indent-left,indent-right,info-sign,italic,leaf,link,list,list-alt,lock,log-in,log-out,magnet,map-marker,minus,minus-sign,move,music,new-window,off,ok,ok-circle,ok-sign,open,paperclip,pause,pencil,phone,phone-alt,picture,plane,play,play-circle,plus,plus-sign,print,pushpin,qrcode,question-sign,random,record,refresh,registration-mark,remove,remove-circle,remove-sign,repeat,resize-full,resize-horizontal,resize-small,resize-vertical,retweet,road,save,saved,screenshot,sd-video,search,send,share,share-alt,shopping-cart,signal,sort,sort-by-alphabet,sort-by-alphabet-alt,sort-by-attributes,sort-by-attributes-alt,sort-by-order,sort-by-order-alt,sound-5-1,sound-6-1,sound-7-1,sound-dolby,sound-stereo,star,star-empty,stats,step-backward,step-forward,stop,subtitles,tag,tags,tasks,text-height,text-width,th,th-large,th-list,thumbs-down,thumbs-up,time,tint,tower,transfer,trash,tree-conifer,tree-deciduous,unchecked,upload,usd,user,volume-down,volume-off,volume-up,warning-sign,wrench,zoom-in,zoom-out".split(","),Icon=$bui.Icon=plugin("Icon",construct);Icon.list=list,Icon.hook("attr","icon","get",function(){return this.change()}),Icon.hook("attr","icon","set",function(text){this.change(text)})}($bui),function($bui){function item(value,title,name){var li=$("<li/>");return $("<span/>").addClass("bui-label").text(title?title:value).appendTo(li),$("<input/>").attr({type:"hidden",name:name+"[]"}).val(value).appendTo(li),$("<a/>").addClass("bui-delete").appendTo(li),li}function unserilize(val,titleMap,name){if(val.constructor!==Array)throw new TypeError("$bui.InputList.val() 参数必须是数组。");for(var title,list=[],i=0,cnt=val.length;cnt>i;i++)titleMap[val[i]]&&(title=titleMap[val[i]]),list[i]=item(val[i],title,name)[0];return $(list)}function construct(){function handler(event){if(!(event.shiftKey||event.ctrlKey||event.altKey)&&13==event.which){var val=$center.val();return $center.val("").focus(),addItem(val),!1}}function addItem(val,title){if(!val)return!1;if(title||titleMap[val]&&(title=titleMap[val]),$this.data("unique")&&value.indexOf(val)>=0)return!1;var name=$this.attr("name");item(val,title,name).appendTo($list),value.push(val),trigger_change($this,value)}var $this=this,value=[],titleMap={},$list=$('<ul class="list"/>').appendTo(this),control=(new $bui.FormControl).appendTo($('<div class="control"/>').appendTo(this)),$center=control.centerWidget($("<input/>").attr("type","text")),addBtn=new $bui.Button(new $bui.Icon("plus"));this.$list=$list,control.append(addBtn),$center.on("keydown",handler),this.centerWidget=function(newinput){$center.off("keydown",handler),$center=control.centerWidget(newinput),newinput.attr("name",""),newinput.on("keydown",handler)},this.on("click",".bui-delete",function(e){var v=$(this).prev().val(),i=value.indexOf(v);i>-1&&value.splice(i,1),$(this).parent().remove(),e.preventDefault()}),this.val=function(v){if(0==arguments.length)return value;var name=$this.attr("name");value=v;var o=unserilize(v,titleMap,name);return o.appendTo($list.empty()),this},addBtn.on("click",mouse_button("left",function(){var val=$center.val();$center.val("").focus(),addItem(val)})),this.addVal=addItem,this.mapTitle=function(map,extend){return void 0===extend||extend?$.extend(titleMap,map):titleMap=map,this}}var InputList=$bui.InputList=plugin("InputList",construct);InputList.hook("attr","name","set",function(v){return this.$list.find("input").attr("name",v+"[]"),v})}($bui),function($bui){function IntInputConstruct(range){function go(){if($this.pressed){$this.pressed>50&&($this.pressed-=Math.round($this.pressed/3));var v=$this.val()+go.dir*$this.prop("speed");$this.val(v),v==last_success_value&&trigger_change($this,v),go._time=setTimeout(go,$this.pressed)}}range||(range="");var last_success_value=0,$this=$bui.FormControl.call(this);$this.val(0);var r=$this.range=new Range;$this.prop("speed",1);var $input=$this.$input=$this.centerWidget().addClass("text-center").attr("type","number").on("keydown",keycodefilter("or","[96,105]","[48,57]","109","189",function(){$this.removeClass("has-error")})).change(function(){$this.val($(this).val()),trigger_change($this,$this.val())});return $this.$left=$this.prepend($bui.Button(new $bui.Icon("arrow-left"),"span","default")),$this.$right=$this.append($bui.Button(new $bui.Icon("arrow-right"),"span","default")),$input.setValue=function(val){var value=parseInt(val);return value==val&&r.test(value)?$this.hasClass("has-error")?($this.removeClass("has-error"),!1):(last_success_value=val,val):(value=r.fit(value),$this.addClass("has-error"),value+"")},$input.getValue=intval,$this.attr("range",range),$this.alert(""),$this.$left.mousedown(function(event){function up(){clearTimeout(go._time),$this.pressed=!1,$(document).off("mouseup",up)}event.which>2||($this.pressed=500,go.dir=-(1+9*(event.which-1)),go(),$(document).on("mouseup",up))}),$this.$right.mousedown(function(){function up(){clearTimeout(go._time),$this.pressed=!1,$(document).off("mouseup",up)}event.which>2||($this.pressed=500,go.dir=1+9*(event.which-1),go(),$(document).on("mouseup",up))}),$this.on("mousewheel",function(e,delta){return $this.pressed=1e3,go.dir=delta,go(),$this.pressed=!1,!1}),$this.removeClass("has-error")}var IntInput=$bui.IntInput=plugin("IntInput",IntInputConstruct);IntInput.hook("attr","range","get",function(){return""+this.range}),IntInput.hook("attr","range","set",function(rangeStr){this.range.fromString(rangeStr);var value=this.val(),fitvalue=this.range.fit(value);value!=fitvalue&&(this.val(fitvalue),trigger_change(this,fitvalue))}),IntInput.proxyInput=!0}($bui),function(){function setValue(){}var construct=function(){function init(){for(var _ms='<ul multiple class="bui-select list-group">',ms_="</ul>",ss='<select multiple name="'+this.name+'[]" style="display:none;">',se="</select>",options="",lis="",i=0;this.options.length>i;i++)options+=' <option value="'+this.options[i][1]+'">'+this.options[i][0]+"</option>",lis+=' <li class="btn  list-group-item bui-select-option">'+this.options[i][0]+"</li>";_self.$list=$(_ms+lis+ms_).appendTo(_self),_self.$select=$(ss+options+se).appendTo(_self)}var _self=this;if(this.$list={},this.$select={},this.options=[],arguments.length>0){var args=Array.prototype.slice.call(arguments),args1=args.shift();this.name=args1.name,this.lines=args1.lines;for(var i=0;args1.options.length>i;i++)this.options.push(args1.options[i]);init.call(this)}this.appendTo=function(s){$.fn.appendTo.call(this,s),this.adjustSize()},this.addItem=function(n,v){var arr=Array(n,v);this.options.push(arr),this.$list?(this.$select.append(' <option value="'+v+'">'+n+"</option>"),this.$list.append(' <li class="btn  list-group-item bui-select-option">'+n+"</li>")):this.init()},this.adjustSize=function(){this.$select.css({height:this.lines*this.$list.find("li").get(0).clientHeight})}};plugin("MultiSelect",construct,setValue)}($bui),$(document).on("click",".bui-select-option",function(){var $this=$(this),$select=$this.parent().next();$select.focus(),$select.find("option").eq($this.index()).click(),console.log($select);var item=$select.find("option").get($this.index());item.selected=!item.selected,$this.toggleClass("btn-primary")}),function($bui){function construct(){function doSelect(name){if(name){var new_index=name_list.indexOf(name);if(current!==new_index){var new_item=items[new_index];trigger_change($this,new_index,name,new_item),new_item._item.attr("name",name),new_item.addClass("active"),-1!=current&&(items[current]._item.attr("name",""),items[current].removeClass("active")),current=new_index}}}var $this=this,items=[],name_list=[],current=-1;this.addItem=function(buiItem){var name=buiItem.attr("name");if(!name)throw Error("bui.OneOf.addItem 参数必须是其他bui object，或者有name属性的元素");buiItem.attr("name",""),buiItem.attr("tabindex","-1");var $div=$('<div class="line"/>'),ico=new $bui.Icon("unchecked").addClass("one_state");return $('<div class="icon"/>').append(ico).appendTo($div),$('<div class="control"/>').append(buiItem).appendTo($div),$div._item=buiItem,$div.appendTo(this),items.push($div),name_list.push(name),-1==current&&doSelect(name),$div.on("click",function(){doSelect(name)}),buiItem.on("change",function(){doSelect(name)}),this},this.focus(function(){items[current].focus()})}$bui.OneOf=plugin("OneOf",construct)}($bui),$(document).on("shown.bs.tab",function(e){var $this=$(e.target),$that=$this.closest("ul:not(.dropdown-menu)>.active");$that.length||$this.addClass("active")}),function($bui){function ProgressConstructor(){this.addClass("progress");var $bar=$('<div class="progress-bar"  role="progressbar"/>').appendTo(this),$acc=$('<span class="sr-only"/>').appendTo($bar);$bar._setvalue=function(v){$bar.css("width",v+"%"),$acc.text("已经完成百分之"+v)},this._progress=0,this._bui_bar=$bar;var lastalert="";this.alert=function(type){lastalert&&(this.removeClass(lastalert),lastalert=""),type&&(lastalert="progress-bar-"+type,this.addClass(lastalert))}}var Progress=$bui.Progress=plugin("Progress",ProgressConstructor);Progress.hook("attr","progress","set",function(progress){this._bui_bar._setvalue(progress),this._progress=progress}),Progress.hook("attr","progress","get",function(){return this._progress})}($bui),function($bui){function hide(){current&&(current.removeClass("active"),current=null)}function item(title,value){return $("<li/>").attr("value",value).append($("<a/>").html(title))}function Select(){var item_list={},$this=this.addClass("form-control btn btn-default"),$list=$('<ul class="dropdown-menu" role="menu"/>');this.addOption=function(title,value){item_list[value]=title,$list.append(item(title,value))},this.find("option").each(function(){$this.addOption($(this).val(),$(this).text()),$(this).remove()}),$list.append(this.children()).appendTo(this);var $btn=$('<div class="bui-toggle"/>').prependTo($this);$this.$show=$("<span/>").appendTo($btn),$('<span class="caret"/>').appendTo($btn),$this.$input=$("<input/>").attr("type","hidden").val("").prependTo($this),$this.$input.setValue=function(v){return item_list.hasOwnProperty(v)?($this.$show.text(item_list[v]),v):($this.$show.text($this.attr("title")),"")},this.attr("title")||this.attr("title","请选择"),$this.click(function(){return $this.hasClass("active")?hide():(hide(),current=$this.addClass("active")),!1}),$list.on("click","li",function(){var v=$(this).attr("value");return $this.$input.val(v),$this.$show.text($(this).text()),hide(),trigger_change($this,v),!1})}var plug=$bui.Select=plugin("Select",Select);plug.proxyInput=!0,plug.init=function(){$(document).on("click",hide)},plug.hook("attr","title","set",function(v){return this.$input&&!this.$input.val()&&this.$show.text(v),v});var current=null}($bui),function($bui){function construct(state){function dragHandler(e){function moveHandler(e){left=e.pageX-start,0>=left||left>=max||($btn.css("left",e.pageX-start),$mask.css("left",e.pageX-start))}function dropHandler(){($this.current_status&&max/2>left||!$this.current_status&&left>max/2)&&($this.val(!$this.current_status),trigger_change($this,$this.current_status)),$btn.css("left",""),$mask.css("left",""),$this.removeClass("drag"),$(document).off("mouseup",dropHandler),$btn.off("mouseleave",preventToggle),$(document).off("mousemove",moveHandler)}if(!$this._lock){$this.addClass("drag");var max=$this.width(),start=e.pageX-parseFloat($btn.css("left")),left=0;$(document).on("mouseup",dropHandler),$(document).on("mousemove",moveHandler),$btn.on("mouseleave",preventToggle)}}function preventToggle(){dragstate=!0}var $this=this;this.current_status=!!state,this.icon=new $bui.Icon(""),this.$input=$("<input/>").val("true").attr("type","hidden").appendTo(this),this.$input.setValue=function(value){return value=bui_bool(value),$this[(value?"add":"remove")+"Class"]("on"),$this.current_status=value,value?"true":"false"},this.$input.getValue=function(){return $this.current_status};var $switcher=$("<div/>").addClass("bui-switch-container").appendTo(this),$btn=$('<span class="btn btn-default bui-switch-btn"/>').appendTo($switcher),$mask=$('<div class="bui-switch-mask"/>').appendTo($switcher);$('<span class="bui-switch-blue"/>'),this.$btn=$btn;var dragstate=!1;$btn.on("mousedown",dragHandler),this.val(this.current_status),this.on("click",function(){return dragstate?(dragstate=!1,void 0):($this._lock||($this.val(!$this.current_status),trigger_change($this,$this.current_status)),void 0)})}var Switch=$bui.Switch=plugin("Switch",construct);Switch.proxyInput=!0,Switch.hook("attr","disabled","set",function(v){return"string"==typeof v&&(v="disabled"==v.toLowerCase()),v?(this.$btn.addClass("disabled"),this.addClass("disabled")):(this.$btn.removeClass("disabled"),this.removeClass("disabled")),this._lock=v,v})}($bui),function($bui){function UploadSingleConstructor(option){function state_empty(){preview.popover("hide"),uploadStart.addClass("disabled"),clearUpload.addClass("disabled"),$input.val("").removeAttr("disabled"),progress.attr("progress",0),state=0}function state_ready(){uploadStart.removeClass("disabled"),clearUpload.removeClass("disabled"),$input.attr("disabled","disabled"),state=1}function state_upload(){preview_content=null,preview.popover("hide"),uploadStart.addClass("disabled"),clearUpload.removeClass("disabled"),$input.attr("disabled","disabled"),state=2}if("string"==typeof option&&(option={url:option}),!option||!option.url)throw Error("bui.UploadSingle 构造必须指定一个url");option=$.extend({dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:5e6,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewMaxWidth:100,previewMaxHeight:100,maxChunkSize:4e6,multipart:!1,previewCrop:!0,current:null},option);var $container=(new $bui.FormControl).appendTo(this),current=option.current,$this=this;this.$input=$('<input style="display: none!important;"/>').attr("type","text").appendTo(this),this.$input.getValue=function(){return current},this.$input.setValue=function(v){return current=v};var $input=$container.centerWidget($("<input/>").attr("type","file")),progress=new $bui.Progress;progress.addClass("progress-striped active").css({width:"200px"}),$container.append(progress);var current_preview=$("<span/>").append(new $bui.Icon("eye-open"));$container.prepend(current_preview),current_preview.popover({html:!0,title:"当前图片",content:function(){return current?'<img src="'+current+'" width="100" height="100"/>':'<div style="width:100px;height:100px;text-align:center;">无</div>'},placement:"auto",trigger:"hover"});var preview_content="",preview=$input.parent().popover({html:!0,title:"选中的图像",content:function(){return preview_content?preview_content:"没有选中"},placement:"auto bottom",trigger:"manual hover"}),upload_instance={},uploadStart=new $bui.Button(new $bui.Icon("cloud-upload")).click(function(){$(this).hasClass("disabled")||(upload_instance.submit(),state_upload())}),clearUpload=new $bui.Button(new $bui.Icon("remove")).click(function(){$(this).hasClass("disabled")||(2==state&&upload_instance.abort(),state_empty())});$container.append(uploadStart),$container.append(clearUpload),$input.fileupload(option).on("fileuploadadd",function(e,data){console.log("add",data),state_ready()}).on("fileuploadprocessalways",function(e,data){upload_instance=data;var index=data.index,file=data.files[index];return file?(file.preview&&(preview_content=file.preview,preview.popover("show")),file.error?(preview_content="上传失败",preview.popover("show")):state_ready(),void 0):state_empty()}).on("fileuploadprogressall",function(e,data){var pers=parseInt(1e3*data.loaded/data.total,10)/10;progress.attr("progress",pers)}).on("fileuploaddone",function(e,data){var file=data.result.files[0];file.url?($this.val(file.url),current_preview.popover("show")):file.error&&($this.val(option.current),preview_content="上传失败",preview.popover("show")),state_empty()}).on("fileuploadfail",function(){preview_content="发生网络错误，上传失败，请重试。",preview.popover("show"),state_empty()});var state=0;state_empty()}var UploadSingle=$bui.UploadSingle=plugin("UploadSingle",UploadSingleConstructor);UploadSingle.proxyInput=!0}($bui)})(window);